"use strict";var f=Object.defineProperty;var b=Object.getOwnPropertyDescriptor;var S=Object.getOwnPropertyNames;var w=Object.prototype.hasOwnProperty;var y=(r,e)=>{for(var o in e)f(r,o,{get:e[o],enumerable:!0})},D=(r,e,o,t)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of S(e))!w.call(r,i)&&i!==o&&f(r,i,{get:()=>e[i],enumerable:!(t=b(e,i))||t.enumerable});return r};var P=r=>D(f({},"__esModule",{value:!0}),r);var T={};y(T,{default:()=>R});module.exports=P(T);var h=require("../core/index.cjs"),p=require("../node/index.cjs"),m=require("../server/index.cjs"),n=require("path"),s=require("fs");var R=(r={})=>e=>{if(r.enabled==null&&(r.enabled=process.env.NODE_ENV!=="production"),r.enabled===!1)return e;let o={...e},t=E(process.cwd()),i=(0,n.dirname)(t);process.env.BUILDER_REMIX_DEVTOOLS_URL="http://localhost:5273/",o.watchPaths=async()=>{let l=await(0,p.createDevToolsNodeSys)({cwd:i}),c=await(0,h.createDevTools)(l),a=await(0,m.createDevToolsServer)({...c,getClientId:()=>"remix-builder-dev-tools",closeAppServer:async()=>{},restartAppServer:async()=>{l.debug("restart server");let d=(0,s.readFileSync)(t,"utf-8");(0,s.writeFileSync)(t,d)},enableAppWatch:async d=>d,...l,...r});return process.env.BUILDER_REMIX_DEVTOOLS_URL=a.getUrl(),typeof e.watchPaths=="function"?e.watchPaths():e.watchPaths?e.watchPaths:[]};let v;v=__dirname;let u=(0,n.join)(v,"server-build","index.mjs");if(!(0,s.existsSync)(u))return console.log(`Builder Devtools unable to run: "${u}" not found`),e;if(typeof e.server=="string"){let l=(0,n.resolve)((0,n.dirname)(t),e.server);if(!(0,s.existsSync)(l))return console.log(`Builder Devtools unable to run: "${l}" set from "${e.server}" server config not found`),e;let c=!1,a=(0,s.readFileSync)(l,"utf-8");for(;a.includes("@remix-run/dev/server-build");)a=a.replace("@remix-run/dev/server-build","@builder.io/dev-tools/remix/server-build"),c=!0;c&&(0,s.writeFileSync)(l,a)}else o.server=u;return o};function E(r){let e=(0,n.resolve)("/");for(let o=0;o<20;o++){let t=(0,n.join)(r,"remix.config.js");if((0,s.existsSync)(t)||(t=(0,n.join)(r,"remix.config.ts"),(0,s.existsSync)(t)))return t;if(r===e)break;r=(0,n.dirname)(r)}throw new Error("Could not find Remix config")}
